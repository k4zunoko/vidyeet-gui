# Release Checklist

## リリース前の準備

### バージョン管理

- [ ] `package.json` のバージョンを更新
  - セマンティックバージョニング（SemVer）に従う
  - 例: `0.1.0` → `0.2.0` (機能追加), `0.1.0` → `0.1.1` (バグ修正)
- [ ] `CHANGELOG.md` を更新（存在する場合）
  - 新機能、バグ修正、破壊的変更を記載
- [ ] バージョンタグをGitに作成（CI/CDを使用する場合）
  ```bash
  git tag -a v0.1.0 -m "Release version 0.1.0"
  git push origin v0.1.0
  ```

### アイコンとアセット

- [ ] `build/icon.ico` が配置されている
  - 複数サイズを含む（16, 32, 48, 64, 128, 256px）
  - 32bitカラー深度（アルファチャンネル）
- [ ] アイコンが正しく表示されるか確認
  ```bash
  npm run build:dir
  # win-unpacked/Vidyeet.exe のアイコンを確認
  ```

### 設定ファイルの確認

- [ ] `electron-builder.json5` の設定を確認
  - `appId`: 適切なアプリケーションID
  - `productName`: 製品名（Vidyeet）
  - `win.publisherName`: 発行者名
  - `nsis.language`: 適切な言語コード
- [ ] CLIファイルが存在する
  - `bin/vidyeet-cli.exe` が配置されている
  - 最新バージョンのCLIであることを確認

### コード品質

- [ ] TypeScriptコンパイルエラーがない
  ```bash
  npm run build:dir
  ```
- [ ] 開発環境で動作確認
  ```bash
  npm run dev
  ```
- [ ] 以下の機能が正常に動作することを確認
  - [ ] 認証（ログイン/ログアウト）
  - [ ] 動画一覧の取得と表示
  - [ ] サムネイル表示
  - [ ] HLS再生
  - [ ] アップロード（進捗表示を含む）
  - [ ] 削除（確認ダイアログを含む）
  - [ ] MP4リンクのコピー
  - [ ] ウィンドウ操作（最小化/最大化/閉じる）

## ビルド実行

### 本番ビルド

- [ ] クリーンビルドを実行
  ```bash
  # 既存のビルド成果物を削除
  rm -rf dist dist-electron release
  
  # 本番ビルド
  npm run build:win
  ```
- [ ] ビルドが正常に完了した
- [ ] インストーラーが生成された
  - `release/${version}/Vidyeet-${version}-Setup.exe`

### ビルド成果物の確認

- [ ] ファイルサイズが妥当か確認
  - インストーラー: 80-150 MB程度
- [ ] ファイル名が正しい
  - 例: `Vidyeet-0.1.0-Setup.exe`
- [ ] ウイルススキャンを実行（オプション）
  ```bash
  # Windows Defender でスキャン
  # または VirusTotal にアップロード
  ```

## インストールテスト

### クリーンインストール

- [ ] テスト用の新しいWindowsユーザーアカウントまたはVM環境を準備
- [ ] インストーラーを実行
  - [ ] SmartScreen警告が表示される（署名なしの場合）
  - [ ] インストールウィザードが正常に進行する
  - [ ] インストール先ディレクトリが変更可能
  - [ ] デスクトップショートカットが作成される
  - [ ] スタートメニューにショートカットが作成される
- [ ] インストール完了後、アプリが自動起動する
- [ ] アプリケーションが正常に起動する

### 動作確認

- [ ] フレームレスウィンドウが正しく表示される
- [ ] カスタムタイトルバーの動作
  - [ ] 最小化ボタン
  - [ ] 最大化/元に戻すボタン
  - [ ] 閉じるボタン
- [ ] ログイン機能
  - [ ] 認証情報の入力
  - [ ] ログイン成功後、一覧画面に遷移
- [ ] 動画一覧
  - [ ] サムネイルが表示される
  - [ ] ホバー時にGIF表示
  - [ ] 選択時にHLS再生
- [ ] アップロード
  - [ ] ファイル選択ダイアログ
  - [ ] 進捗表示
  - [ ] 完了後に一覧更新
  - [ ] 進捗ダイアログの最小化/展開
  - [ ] ドラッグ＆ドロップ
- [ ] 右クリックメニュー
  - [ ] MP4リンクのコピー
  - [ ] 削除（確認ダイアログ）
- [ ] ログアウト機能

### CLI連携の確認

- [ ] `vidyeet-cli.exe` が正しく配置されている
  - インストール先: `resources/bin/vidyeet-cli.exe`
- [ ] CLI呼び出しが正常に動作する
  - [ ] `status` コマンド
  - [ ] `login` コマンド
  - [ ] `list` コマンド
  - [ ] `upload` コマンド
  - [ ] `delete` コマンド

### エラーハンドリング

- [ ] ネットワークエラー時の挙動
  - [ ] オフライン状態でエラーメッセージ表示
- [ ] 認証エラー時の挙動
  - [ ] 無効な認証情報でエラー表示
- [ ] ファイル選択のキャンセル
- [ ] アップロード失敗時のエラー表示

### アンインストールテスト

- [ ] Windowsの「アプリと機能」から正常にアンインストールできる
- [ ] アンインストール後、以下が削除されている
  - [ ] インストールディレクトリ（`%LOCALAPPDATA%\Programs\Vidyeet`）
  - [ ] デスクトップショートカット
  - [ ] スタートメニューショートカット
- [ ] 以下が保持されている（`deleteAppDataOnUninstall: false` のため）
  - [ ] `%APPDATA%\vidyeet-gui\` （存在する場合）
  - [ ] CLI認証情報（CLI管理下）

### 再インストールテスト

- [ ] アンインストール後、再度インストールできる
- [ ] 再インストール後、認証情報が保持されている（ログイン不要）

## パフォーマンステスト

- [ ] 起動時間が妥当（5秒以内）
- [ ] メモリ使用量が妥当（500MB以内）
- [ ] 大量の動画（100件以上）での動作確認
- [ ] 長時間稼働での動作確認（メモリリークなし）

## セキュリティチェック

- [ ] 認証情報がログに出力されていない
- [ ] エラーメッセージに機密情報が含まれていない
- [ ] 外部通信が適切（Mux APIのみ）
- [ ] ファイルアクセスが適切な範囲内

## ドキュメント

- [ ] `README.md` が最新の情報に更新されている
- [ ] `docs/` 配下のドキュメントが実装と一致している
- [ ] `WINDOWS_BUILD.md` のビルド手順が正しい
- [ ] システム要件が明記されている

## リリース資材の準備

### 成果物

- [ ] インストーラーファイル（`.exe`）
- [ ] チェックサム（SHA-256）の生成
  ```bash
  certutil -hashfile release/0.1.0/Vidyeet-0.1.0-Setup.exe SHA256
  ```
- [ ] リリースノートの作成
  - 新機能
  - バグ修正
  - 既知の問題
  - システム要件

### 配布

- [ ] ファイルのアップロード先を決定
  - GitHub Releases
  - 独自のダウンロードサーバー
  - その他
- [ ] ダウンロードリンクの作成
- [ ] 更新通知（必要な場合）

## コード署名（製品版のみ）

- [ ] コード署名証明書を取得済み
- [ ] `electron-builder.json5` に署名設定を追加
  ```json5
  {
    "win": {
      "certificateFile": "path/to/cert.pfx",
      "certificatePassword": "${env.CERT_PASSWORD}",
      "signingHashAlgorithms": ["sha256"]
    }
  }
  ```
- [ ] 署名付きビルドを実行
- [ ] SmartScreen警告が表示されないことを確認

## 公開後

- [ ] ユーザーからのフィードバック収集
- [ ] エラーレポートの監視
- [ ] 次回リリースに向けた改善点の洗い出し

## トラブルシューティング

### ビルドエラー

| エラー | 原因 | 解決方法 |
|--------|------|----------|
| `icon.ico not found` | アイコンファイルが存在しない | `build/icon.ico` を配置 |
| `ENOENT: bin` | CLIファイルが存在しない | `bin/vidyeet-cli.exe` を配置 |
| メモリ不足 | Node.jsのメモリ制限 | `NODE_OPTIONS=--max-old-space-size=4096` |

### インストールエラー

| 問題 | 原因 | 解決方法 |
|------|------|----------|
| SmartScreen警告 | 署名なし | コード署名を追加（または「詳細情報」で回避） |
| 起動しない | ランタイムエラー | イベントビューアーでログ確認 |
| CLI が見つからない | パス解決エラー | `process.resourcesPath` の確認 |

## リリース判断基準

以下のすべてを満たす場合にリリース可能:

- [ ] すべての必須機能が動作する
- [ ] 致命的なバグが存在しない
- [ ] インストール/アンインストールが正常に動作する
- [ ] ドキュメントが整備されている
- [ ] セキュリティチェックに合格している

## 最終確認

- [ ] 上記すべてのチェック項目をクリアした
- [ ] リリース責任者の承認を得た（チームの場合）
- [ ] リリース日時を決定した

---

**リリース実行日**: ____________________

**リリース実行者**: ____________________

**バージョン**: ____________________

**備考**:
