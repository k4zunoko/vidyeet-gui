# UI Spec

このドキュメントは、画面と状態遷移を固定するための仕様です。実装はここに追従させます。

## 画面一覧（現実装）

- 認証（Login）
- 一覧（Library）
- 再生（Player）※一覧画面内のメイン領域に表示

補足（画面を横断するUI要素）:

- カスタムタイトルバー（フレームレスウィンドウ）
- 右ドロワー（アップロード/ログアウト）
- グローバルコンテキストメニュー（リンクコピー/削除）
- 削除確認ダイアログ
- アップロード進捗ダイアログ

## 起動時状態遷移

1. App起動
2. 認証チェック中（`status` 実行）
3. `is_authenticated=true` なら一覧取得へ
4. 未認証なら認証画面へ（成功するまでブロック）

## UI/UXチェック項目（MVP）

この章は [UX_PSYCHOLOGY.md](./UX_PSYCHOLOGY.md) をベースに、MVPの画面ワイヤーで「どの原則をどこに適用するか」をチェック項目として固定します。

### 共通（全画面）

- 認知負荷: 画面上の選択肢・文言・情報量が、目的タスク（ログイン/一覧/再生）を邪魔していない
- 段階的開示: 今すぐ不要な情報/操作は隠せている（MVPでは“最短経路”を優先）
- 視覚的階層: 主行動（Primary Action）と次善行動が見分けられる
- ドハティの閾値: 0.4秒を超えそうな処理は、必ず「待ちのフィードバック」がある（スケルトン/プレースホルダ/短い状態文）
- フレーミング: エラー文言は断定や責める言い方を避け、次の行動（再試行/ログイン等）に収束する

## 認証画面（Login）

### 目的

- CLI にログイン処理を委譲し、成功/失敗をユーザーに返す

### 入力

- Token ID
- Token Secret

### 振る舞い

- 「ログイン」押下で CLI のログイン処理を開始
- 失敗時はエラー表示し、入力を保持して再試行可能
- 成功時は即座に一覧取得へ遷移

※ CLI は `login --stdin` により標準入力から認証情報を受け取れるため、GUI側では「入力→stdinへ渡す」方式を採用する。実装方針は [CLI_CONTRACT.md](./CLI_CONTRACT.md) に従う。

### UXチェック（Login）

- 認知負荷: 入力項目は必要最小限（Token ID / Token Secret のみ）で、補足説明は短くする
- 視覚的階層: Primary Action（ログイン）が最も目立つ。Secondary（キャンセル等）がある場合は控えめにする
- ドハティの閾値: ログイン実行中は「ログイン中…」等の状態を必ず表示し、ボタン二度押しを防ぐ
- ピーク・エンド: 成功時は短い肯定メッセージで区切り、失敗時は入力を保持して“復帰できる終わり方”にする
- フレーミング: 失敗理由は断定せず（例: “認証に失敗しました。Token ID/Secret を確認して再試行してください”）、次の一手を提示する

## 一覧画面（Library）

### 表示

- 動画カード（サムネイル、簡易メタ情報）を並べる
- サムネイルが取れない場合はエラー状態を表示（リトライ導線があれば尚良いがMVPでは必須ではない）

現実装の配置:

- 左: 一覧（サムネイルグリッド）
- 右: プレイヤー + 情報パネル

### 操作

- ホバー: GIF を表示
- クリック/選択: プレイヤーへ反映（HLS再生）

追加（現実装）:

- 右クリック: コンテキストメニューを表示
	- 対象は再生可能な動画のみ（`playback_id` があるもの）
- タイトルバーのメニュー操作で右ドロワーを開閉

### 取得

- 初回表示時に `list` を実行
- リロード操作を提供するかはMVPでは任意（実装する場合は `list` 再実行）

現実装:

- 初回表示で `list`
- タイトルバーのリロードで `list` を再実行

### UXチェック（Library）

- 認知負荷: カードに載せる情報を増やしすぎない（サムネ中心 + 最小の状態）
- 段階的開示: 詳細情報/高度操作（削除・コピー等の将来機能）は後から追加しても破綻しない配置にしておく（例: 右クリック、詳細パネル）
- 視覚的階層: 選択中/再生中のカードが一目で分かる（枠/ラベル等）
- ドハティの閾値: 一覧取得中はカード枠のプレースホルダ等で“待ち”を見せる（空白で待たせない）
- バナー・ブラインドネス: 重要な状態表示を広告バナー風にしない（見落とされない見た目にする）
- 決断疲れ: 操作を増やしすぎない（MVPでは「選択して再生」に集中）

## 再生（Player）

- 選択された `playback_id` から `https://stream.mux.com/{PLAYBACK_ID}.m3u8` を生成して再生
- 再生失敗時はエラー表示し、別動画選択や再試行ができる

追加（現実装）:

- プレイヤー領域でも右クリックでコンテキストメニューを表示できる（選択中動画がある場合）

## 情報パネル（Video Info）

- 選択中動画のメタ情報を表示する
- 表示項目（現実装・一覧取得データに基づく）:
	- 時間（mm:ss）
	- 解像度 / アスペクト比 / フレームレート
	- 作成日
	- ステータス

※ 追加の詳細取得（`show`）は現時点では行わない。

## コンテキストメニュー（右クリック）

表示条件:

- ライブラリのカード: `playback_id` がある動画のみ
- プレイヤー: 選択中かつ `playback_id` がある場合のみ

項目（現実装）:

- 「リンクをコピー」: MP4 URL（`/highest.mp4`）をクリップボードにコピー
- 「削除」: 削除確認ダイアログを開く

閉じ方:

- 外側クリック
- `Esc`

## 削除確認ダイアログ

- 破壊的操作のため、確認ダイアログを必須にする
- 「削除する」押下で `vidyeet:delete` を実行
- 削除中はボタンを無効化し、状態文言を表示
- 成功時はダイアログを閉じ、一覧から除去し、必要なら選択解除

## アップロードダイアログ

### 設計方針（ノンモーダル）

Nielsen Norman Groupの人間工学的知見に基づき、**ノンモーダル（非ブロッキング）ダイアログ**として実装します。

**モーダルを避ける理由:**
- アップロードは長時間処理（10秒以上）で、ユーザーが他の作業をしたい
- 致命的な処理ではないため、ワークフローをブロックする必要がない
- ユーザーに制御を与えることで満足度が向上

### 表示仕様

- **位置**: 画面右下に固定（`right: 1.5rem; bottom: 1.5rem;`）
- **z-index**: 1000（タイトルバーより低く、他のコンテンツより高い）
- **背景**: ブロックしない（オーバーレイなし）
- **アニメーション**: 下からスライドイン（0.3秒）

### 開始トリガー

- ドロワーの「アップロード」押下
- ファイル選択ダイアログを表示（キャンセルで中断）
- **ドラッグアンドドロップ** でも開始可能（エクスプローラー等から直接ドロップ）
- **複数ファイル対応**: ファイル選択・ドラッグアンドドロップともに複数ファイルを受付

### 進捗表示

- `vidyeet:upload` 実行中は進捗ダイアログを表示
- 進捗は `vidyeet:uploadProgress` イベントで更新する
- `uploading_chunk` フェーズではプログレスバーを表示
- **キューシステム（Phase 1実装済み）**:
  - 複数ファイル選択時は自動的にキューに追加
  - 1ファイルずつ逐次アップロード（並列実行なし）
  - 現在のファイルの進捗を表示
  - 待機中リストを表示（キャンセル可能）
  - エラー発生時も次のファイルを処理継続
  - 各ファイル成功時に個別リロード（一覧に即座に追加）
- 完了時はトースト通知を表示

### 操作機能

**通常表示状態:**
- **最小化ボタン**: アップロード中のみ表示、コンパクトバーに縮小
- **閉じるボタン**: エラー時のみ表示、ダイアログを閉じる
- **キューアイテムのキャンセル**: 待機中のファイルは個別にキャンセル可能

**最小化状態:**
- **コンパクトバー**: ファイル名 + 進捗率/件数 + スピナー
  - 単一ファイル: 進捗率（例: 65%）
  - 複数ファイル: 件数（例: 2/5）
- **クリックで復元**: バーをクリックすると通常表示に戻る

### UXチェック（Upload Dialog - Non-modal）

- **Nielsen Norman Group準拠**: 長時間処理にはノンモーダルが適切
- **ユーザー制御**: 最小化・復元・キャンセルで自由に操作可能
- **ドハティの閾値**: アップロード開始から即座にダイアログ表示
- **視覚的階層**: 右下配置で主要操作領域を邪魔しない
- **ツァイガルニク効果**: 最小化しても進捗が見えることで安心感を提供、待機中リストで未完了タスクを明示
- **ピーク・エンドの法則**: 完了時はトースト通知で達成感を演出
- **エラー時の復帰**: 1ファイル失敗しても他のファイルは処理継続（resilient design）

### キュー表示仕様（Phase 1実装済み）

**ヘッダー:**
- 複数ファイル時: 「アップロード中 (2/5)」形式で進捗を表示
- 単一ファイル時: 「アップロード中」

**現在のファイル:**
- ファイル名表示
- プログレスバーまたはスピナー
- フェーズテキスト（「アップロード中...」など）

**待機中リスト:**
- セクション分離: ボーダーで現在のファイルと区別
- 件数表示: 「待機中 (3件)」
- アイテム表示: ファイル名 + キャンセルボタン
- スクロール: 最大高150px、超過時はスクロール可能

**完了時の動作:**
- 全ファイル完了時にキューをクリア
- トースト通知で結果を表示:
  - 全成功: 「N件のアップロードが完了しました」
  - 一部失敗: 「N件完了、M件失敗しました」

### プログレスバー表示仕様

`uploading_chunk` フェーズ（実際のファイルアップロード中）に、スピナーからプログレスバーに切り替わる。

#### 表示内容

- プログレスバー: 送信済みバイト数 / 総バイト数 のパーセンテージ
- パーセンテージ表示: 数値（例: "45%"）
- バイト数表示: 人間が読みやすい形式（例: "3.5 MB / 10 MB"）
- チャンク進捗: UI上でチャンク番号（例: 現在のチャンク番号 / 総チャンク数）をテキスト表示しません。代わりに送信済みバイト数 / 総バイト数 に基づく bytes ベースのパーセンテージ表示を優先します。CLI が `current_chunk` / `total_chunks` を提供する場合でも、内部の補間ロジック（Progress Interpolation）のヒントとしてのみ利用します。

#### デザイン

- トラック: 8px高、角丸、暗い背景
- フィル: プライマリカラーのグラデーション、スムーズなトランジション（0.3秒）
- 完了時: 緑色に変化（ピーク・エンドの法則を適用）
- シマーアニメーション: 進行中は光沢が流れるエフェクト

#### UXチェック（Progress Bar）

- Nielsen Norman Group の指針: 10秒以上の処理には percent-done indicator を使用
- ドハティの閾値: スムーズなアニメーションで待ち時間を軽減
- 視覚的階層: バーが主役、数値は補助情報
- ピーク・エンドの法則: 完了時の色変化で達成感を演出
- 認知負荷: 必要な情報のみ表示（パーセンテージ、バイト数、チャンク進捗）
- ツァイガルニク効果: 進捗が見えることでユーザーは3倍長く待てる（NN/g研究）

失敗:

- エラー文言を表示し、閉じる操作を提供する

### 最小化状態でのエラー表示（改善実装）

**背景**: Nielsen Norman Group の人間工学的研究に基づき、エラーは即座に認識可能でなければならない。最小化状態でもエラーを見落とさないよう、視覚的フィードバックを強化する。

**視覚的指標（NN/g Error-Message Guidelines 準拠）**:

1. **エラーアイコン**: 赤色の警告アイコン（円+感嘆符）
   - スピナーをエラーアイコンに置き換え
   - 色: `var(--color-error, #ef4444)`
   - 視覚的階層: 最も目立つ位置に配置

2. **背景色**: 赤系の半透明背景
   - 通常: 透明
   - エラー: `rgba(239, 68, 68, 0.1)` + 赤枠
   - ホバー: `rgba(239, 68, 68, 0.15)`

3. **テキスト**: 「アップロード失敗」
   - ファイル名から状態説明に変更
   - 色: 赤（`var(--color-error)`）
   - フォントウェイト: 500（中太）

4. **進捗率**: エラー時は非表示
   - 認知負荷を減らすため、混乱を招く情報を削除

**成功時の表示**:

- 緑色のチェックマークアイコン
- 色: `var(--color-success, #22c55e)`
- ピーク・エンドの法則: 達成感を演出（1.5秒後に自動クローズ+トースト）

**インタラクション**:

- クリック: 最小化状態から通常状態に復元
- ツールチップ: 
  - エラー時: 「クリックして詳細を確認」
  - 通常時: 「クリックして展開」

**設計判断の根拠**:

- **ノンモーダル維持**: エラー時も自動展開しない（ユーザーの自由を尊重）
- **視認性**: 3つの冗長な指標（色、アイコン、テキスト）でアクセシビリティ確保
- **認知負荷**: シンプルな視覚言語でエラーを即座に認識可能
- **効率性**: 1クリックで詳細とクローズボタンにアクセス可能

## ドラッグアンドドロップ（グローバル）

ウィンドウ全体でファイルのドラッグアンドドロップを受け付ける。

### 動作仕様

- **ドラッグ検出**: ファイルがウィンドウ上にドラッグされた時点で検出
- **視覚的フィードバック**: ドラッグ中は半透明のオーバーレイを表示
  - 背景: 半透明の黒（95%）
  - 枠線: プライマリカラーの破線（4px）
  - 中央にアップロードアイコンとメッセージ
  - アイコンは bounce アニメーション
- **ドロップ処理**: 動画ファイルのみ受け付け
  - 対応形式: mp4, mov, avi, mkv, webm, ogg
  - 非対応ファイルはトーストでエラー通知
- **アップロード開始**: ドロップ後、即座にアップロード進捗ダイアログを表示

### 視覚的フィードバックの内容

オーバーレイに表示される要素:

- **アップロードアイコン**: プライマリカラー、bounce アニメーション
- **メインメッセージ**: 「ここにファイルをドロップしてアップロード」（1.5rem、太字）
- **ヒント**: 「動画ファイルのみ対応しています」（1rem、ミュート色）

### UXチェック（Upload Dialog - Minimized Error State）

- **視認性**: 3つの冗長な指標（色、アイコン、テキスト）で色覚異常にも対応（NN/g）
- **視覚的階層**: エラーアイコンを最も目立たせ、次の行動を明確に
- **認知負荷**: シンプルな視覚言語（アイコン+短いテキスト）で即座に認識
- **コミュニケーション**: 「失敗しました」ではなく「アップロード失敗」で簡潔に
- **効率性**: 1クリックで詳細+閉じるボタンにアクセス（ユーザーの労力を保護）
- **ピーク・エンド**: エラーでも復帰可能な終わり方（クリックで詳細→閉じる）
- **ノンモーダル維持**: 自動展開しない（ユーザーに制御を与える、NN/g）

### UXチェック（Drag and Drop）

- **視覚的階層**: オーバーレイを最前面（z-index: 9999）に配置し、メッセージを中央に
- **認知負荷**: シンプルなアイコンと明確なメッセージのみ表示
- **段階的開示**: ドラッグ中のみオーバーレイを表示し、通常時は非表示
- **フレーミング効果**: 肯定的な言葉で誘導（「ドロップできません」ではなく「ここにドロップ」）
- **ドハティの閾値**: ドラッグ検出から0.2秒以内にオーバーレイを表示、ドロップ後即座にアップロード開始
- **ピーク・エンドの法則**: ドロップ時のスムーズなアニメーション（0.2秒のフェード）で快適な体験を提供

### エラーハンドリング

- **非対応ファイル**: 「動画ファイルのみアップロードできます」とトースト表示
- **ファイルパス取得失敗**: アップロードダイアログにエラー表示
- **複数ファイル**: 現在は最初の1ファイルのみ処理（将来的には複数対応も検討）

## トースト通知

アクション完了のフィードバックをウィンドウ右下にポップアップ表示する。

### 表示仕様

- 表示位置: ウィンドウ右上（`top: 1rem; right: 1rem;`）
- 自動消去: 成功 3秒、エラー 5秒
- 最大表示数: 3件（超過時は古いものから削除）
- アニメーション: 0.2秒のスライドイン（右から）/フェードアウト
- レイアウト: 最新の通知が常に右上の固定位置に表示され、古い通知が下に押し出される

### タイプ別デザイン

| タイプ | 左ボーダー色 | 用途 |
|--------|-------------|------|
| success | 緑（`--color-success`） | 成功通知 |
| error | 赤（`--color-error`） | エラー通知 |
| info | ピンク（`--color-primary`） | 情報通知 |

### 適用アクション

| アクション | タイプ | メッセージ |
|-----------|-------|-----------|
| URLコピー | success | 「リンクをコピーしました」 |
| 動画削除 | success | 「動画を削除しました」 |
| アップロード完了 | success | 「アップロードが完了しました」 |

### UXチェック（Toast）

- ピーク・エンドの法則: 成功時は短く肯定的なメッセージで良い印象を残す
- ドハティの閾値: アクション直後に即時表示（0.4秒以内）
- 認知負荷: 最小限の情報量（アイコン + 短いメッセージ）
- バナー・ブラインドネス: 控えめだが見落とされないデザイン（左ボーダーで種別を示す）
- 視覚的階層: 主要操作領域（左の一覧、中央のプレイヤー）を邪魔しない右上配置、タイトルバーから適度に離れた位置

### UXチェック（Player）

- 視覚的階層: 再生状態（読み込み中/再生中/停止/エラー）が明確。次の操作が分かる
- ドハティの閾値: 初回バッファなど時間がかかる場合は、プレイヤー枠にローディングを出す
- 認知負荷: 再生に不要な情報を周辺に出しすぎない（まず“見れる/見れない”が分かる）
- ピーク・エンド: 再生開始時/失敗時の区切りが分かり、失敗しても復帰できる導線（別動画選択/再試行）がある

## ローディング/エラー表示方針

- CLI実行中はローディング状態を表示
- エラーは「次に何をすべきか」が分かる文言にする

詳細は [ERROR_HANDLING.md](./ERROR_HANDLING.md)。
