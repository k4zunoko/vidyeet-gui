# Testing Strategy

このプロジェクトは GUI + Electron + 外部CLI という構成のため、テストは「CLIに依存しない層」から固めます。

## 現状（2025-12-26）

- テストランナー（Vitest/Jest 等）は未導入
- まずは契約変換・URL生成・エラー変換など「壊れやすいが純粋関数化しやすい箇所」からユニットテストを追加するのが最短

## レイヤ別の考え方

### ユニットテスト（推奨）

対象:

- JSONパース（`status` / `list` の最小必須フィールド抽出）
- URL生成（thumbnail/gif/hls）
- エラー変換（exit code / timeout / bad json → code/message）

ポイント:

- CLI の実体を使わず、文字列入力→期待オブジェクト/エラーを検証する

### 統合テスト（必要に応じて）

対象:

- Main の CLI runner が正しい引数で `vidyeet-cli.exe` を起動できる
- タイムアウトや非0終了時に正しくエラー化される

方法案:

- テスト用のダミー exe（または node スクリプト）を用意し、stdout に固定JSONを出す
- 実際の Mux 認証やネットワークに依存しないようにする

## 導入時の最小構成（案）

- ランナー: Vitest（Vite/Vue と相性がよい）
- 対象: `src/utils/muxUrls.ts`、CLI出力の変換（Main側）など、ブラウザ/OS依存が薄い箇所

### E2E

- MVP段階では必須にしない（コストが高くなりやすい）
- 追加する場合は「ログイン→一覧→選択→再生」の最短経路のみ

## テスト追加のルール

- バグが出たら、まず再現ケースをテストで固定してから修正する
- CLI JSON 契約が変わった場合、パーサのテストを更新して互換性を担保する
